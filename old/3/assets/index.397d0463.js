var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,i=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&s(e,n,t[n]);if(a)for(var n of a(t))o.call(t,n)&&s(e,n,t[n]);return e},l=(e,a)=>t(e,n(a));import{C as d,R as c,a as m,b as h,c as u,M as y,D as p,d as g,e as x,T as _,f as v,g as E,h as f}from"./vendor.e30c4ed3.js";var w="_app_opddb_1",C="_main_opddb_15",k="_catalog_wrapper_opddb_27";var N="_text_editor_k39rm_1";class b{constructor(e,t,n){var a;this.evt=t,this.ele=e.current,this.text=(null==(a=e.current)?void 0:a.textContent)||"",this.defaultText=n}setTextContent(e){this.ele&&D(this.ele,e),this.ele&&$(this.ele)}}const $=e=>{const t=""===e.textContent;e.setAttribute("data-is-empty",t?"true":"false")},D=(e,t)=>{e.textContent=t||""},S=({defaultText:e,placeholder:t,className:n,disabled:a,onInput:r,onDoubleClick:o,onClick:s,onDisabled:i,onAbled:l})=>{const m=d.exports.createRef();return d.exports.useEffect((()=>{a?i&&i(new b(m,null,e||"")):l&&l(new b(m,null,e||""))}),[a]),d.exports.useEffect((()=>{m.current&&(D(m.current,e||""),$(m.current))}),[e]),c.createElement("div",{ref:m,className:`${N} ${n}`,contentEditable:a?"false":"true",placeholder:t,"data-is-empty":"false",onInput:t=>{m.current&&$(m.current),r&&r(new b(m,t,e||""))},onDoubleClick:t=>{o&&o(new b(m,t,e||""))},onClick:t=>{s&&s(new b(m,t,e||""))}})};var P="_file_controller_1c6r4_1",I="_name_editor_1c6r4_19",F="_file_input_control_1c6r4_65",T="_import_1c6r4_73",O="_export_1c6r4_73";const A=({fileName:e,onFileNameChange:t,onImportFile:n,onExportFile:a})=>{const r=d.exports.createRef(),[o,s]=d.exports.useState(!1),i=()=>{document.removeEventListener("click",i),s(!1)},l=()=>{var e;if(!r.current)return;const t=r.current;if(!t.files||0===(null==(e=t.files)?void 0:e.length))return;const a=t.files[0],o=new FileReader;o.onload=()=>{"string"==typeof o.result&&n(o.result||""),t&&(t.value="")},o.readAsText(a)};return d.exports.useEffect((()=>{var e;return null==(e=r.current)||e.addEventListener("change",l),()=>{var e;null==(e=r.current)||e.removeEventListener("change",l)}})),c.createElement("div",{className:P},c.createElement(S,{className:I,defaultText:e,placeholder:"日记本名",disabled:!o,onClick:e=>{var t,n;o?null==(t=e.evt)||t.stopPropagation():e.evt&&e.ele&&(n=e.ele,e.evt.nativeEvent.stopPropagation(),document.addEventListener("click",i),s(!0),setTimeout((()=>{n.focus()})))},onDisabled:n=>{const a=n.text;""!==a?t(a):n.setTextContent(e)}}),c.createElement("label",{className:T},c.createElement("input",{ref:r,className:F,type:"file"}),c.createElement("div",null,"导入")),c.createElement("div",{className:O,onClick:()=>{a()}},"导出"))};var j="_header_1aiz4_1",Y="_background_1aiz4_33",J="_content_1aiz4_53";const M=({bookName:e,activeYearIndex:t,yearIndexs:n,onBookNameChange:a,onImportFile:r,onExportFile:o})=>c.createElement("div",{className:j},c.createElement("div",{className:Y}),c.createElement("div",{className:J},c.createElement(A,{fileName:e,onFileNameChange:a,onImportFile:r,onExportFile:o})));var R="_diary_page_dvf4n_1",H="_content_editor_dvf4n_21";var B="_title_editor_1hgxa_1";const L=({handle:e,title:t,onChange:n,placeholder:a})=>{const[r,o]=d.exports.useState(t);return d.exports.useEffect((()=>{o(t)}),[e]),c.createElement(S,{key:e,defaultText:r,placeholder:a||"",className:B,onInput:e=>{n&&n(e.text)}})};var V="_rich_text_editor_1i330_1";const z=({handle:e,initialHtmlContent:t,className:n,onChange:a})=>c.createElement(m,{className:`${V} ${n}`,key:e,theme:"snow",defaultValue:t,onChange:e=>{a&&a(e)}});var U="_tag_gex5y_1",q="_text_gex5y_25",W="_delete_button_gex5y_43";const G=({target:e,text:t,onChange:n,onDelete:a})=>{const[r,o]=d.exports.useState(t);return d.exports.useEffect((()=>{o(t)}),[e]),c.createElement("div",{className:U},c.createElement(S,{key:e,defaultText:r,placeholder:"新标签",className:q,onInput:e=>{n(e.text)}}),c.createElement("div",{className:W,onClick:a},""))};var K="_tags_bar_qrfca_1",Q="_add_button_qrfca_25";const X=({tags:e,onTagsChange:t})=>{const n=n=>()=>{const a=e.filter(((e,t)=>t!==n));t(a)};return c.createElement("div",{className:K},e.map(((a,r)=>{return c.createElement(G,{key:r,target:`${e.length}/${r}`,text:a,onChange:(o=r,n=>{const a=[...e];a[o]=n,t(a)}),onDelete:n(r)});var o})),c.createElement("div",{className:Q,onClick:()=>{const n=[...e,""];t(n)}},""))};var Z="_current_path_1luhf_1",ee="_delete_1luhf_17";const te=({path:e,onDeletePath:t})=>c.createElement("div",{className:Z},c.createElement("div",null,e.year),e.month===1/0?void 0:c.createElement("div",null," / ",e.month),e.date===1/0?void 0:c.createElement("div",null," / ",e.date),c.createElement("div",{className:ee,onClick:()=>{t(e)}},"")),ne=({path:e,handle:t,title:n,tags:a,content:r,titleEditorPlaceholder:o,onTitleChange:s,onTagsChange:i,onContentChange:l,onDeletePath:d})=>c.createElement("div",{className:R},c.createElement(te,{path:e,onDeletePath:d}),c.createElement(L,{handle:t,title:n,onChange:s,placeholder:o}),c.createElement(X,{key:t,tags:a,onTagsChange:i}),c.createElement(z,{className:H,onChange:l,handle:t,initialHtmlContent:r}));class ae{constructor(e=""){this.data=e}}class re{constructor(e,t="",n=[],a=new ae("")){this.index=e,this.title=t,this.tags=n,this.content=a}}class oe{constructor(e,t,n="",a=[],r=new ae(""),o=[]){this.yearIndex=e,this.index=t,this.title=n,this.tags=a,this.summary=r,this.diarys=o}}class se{constructor(e,t="",n=[],a=new ae(""),r=[]){this.index=e,this.title=t,this.tags=n,this.summary=a,this.months=r}}class ie{constructor(e="新日记本",t=[new se((new Date).getFullYear())],n=""){this.bookName=e,this.years=t,this.password=n}}class le{constructor(e){this.year=1/0,this.month=1/0,this.date=1/0,e&&this.set().year(e.year).month(e.month).date(e.date)}set(){const e=this,t={year:n=>(e.year=n,t),month:n=>(e.month=n,t),date:n=>(e.date=n,t),done:()=>e};return t}toString(){return`${this.year}/${this.month}/${this.date}`}}const de="V1_JSON",ce="V2_JSON",me="V3_PASSWORD",he="V4_RC4",ue=e=>{const t=(e=>{const t=JSON.parse(JSON.stringify(e));return l(i({},t),{years:t.years.map((e=>l(i({},e),{months:e.months.map((e=>l(i({},e),{diarys:e.diarys.filter((e=>!(""===e.content.data&&0===e.tags.length&&""===e.title)))}))).filter((e=>!(0===e.diarys.length&&""===e.summary.data&&0===e.tags.length&&""===e.title)))})))})})(e),n=h.encrypt(JSON.stringify(t),e.password).toString();return new Blob([he,";",n])},ye=(e,t)=>{switch((e=>{if("{"===e[0])return de;const t=[];let n=0;for(;";"!==e[n];)t.push(e[n]),n++;return t.join("")})(e)){case de:return n=e,l(i({},JSON.parse(n)),{password:""});case ce:return(e=>l(i({},JSON.parse(e)),{password:""}))(e.slice(ce.length+1));case me:return(e=>JSON.parse(e))(e.slice(me.length+1));case he:return((e,t)=>{const n=h.decrypt(e,t).toString(u.exports.enc.Utf8);return JSON.parse(n)})(e.slice(he.length+1),t);default:return new ie}var n},pe=e=>{const t=ue(e);((e,t)=>{const n=document.createElement("a");n.download=e,n.href=window.URL.createObjectURL(t),n.style.display="none",document.body.appendChild(n),n.click()})(`${e.bookName}-${(()=>{const e=new Date;return`${e.getFullYear()}${`0${e.getMonth()+1}`.slice(-2)}${`0${e.getDate()}`.slice(-2)}-${`0${e.getHours()}`.slice(-2)}${`0${e.getMinutes()}`.slice(-2)}${`0${e.getSeconds()}`.slice(-2)}`})()}.diary`,t)},ge=({content:e=[],footer:t=[],show:n=!0,title:a="标题",onDismiss:r=(()=>{})})=>c.createElement("div",{style:{position:"fixed"}},c.createElement(y,{open:n,onClose:r},c.createElement(p,null,a),c.createElement(g,null,e),c.createElement(x,null,t))),xe=({isShow:e,hide:t,verify:n})=>{const[a,r]=d.exports.useState(""),o=()=>{r(""),t()},s=o;return c.createElement(ge,{show:e,title:"输入密码",content:c.createElement(_,{value:a,type:"password",onChange:e=>{(e=>{r(e.target.value)})(e)}}),footer:c.createElement(c.Fragment,null,c.createElement(v,{onClick:()=>{n(a),r(""),t()},variant:"contained"},'"确定"'),c.createElement(v,{onClick:o},'"取消"')),onDismiss:s})},_e=({defaultPassword:e,show:t,hide:n,onExport:a})=>{const[r,o]=d.exports.useState(e),s=()=>{o(""),n()};return c.createElement(ge,{show:t,title:"设置密码",content:c.createElement(c.Fragment,null,c.createElement(E,null,"以下自动填充当前密码，如无需修改，请直接确认导出。"),c.createElement(_,{value:r,type:"password",size:"small",autoFocus:!0,margin:"dense",onChange:e=>{(e=>{o(e.target.value)})(e)}})),footer:c.createElement(c.Fragment,null,c.createElement(v,{onClick:()=>{a(r),o(""),n()},variant:"contained"},"确定"),c.createElement(v,{onClick:s},"取消")),onDismiss:s})};var ve={tree_items:"_tree_items_1ui6u_1",tree_item:"_tree_item_1ui6u_1",content:"_content_1ui6u_19",children:"_children_1ui6u_65"};var Ee="_tree_item_1ui6u_1",fe="_content_1ui6u_19",we="_children_1ui6u_65";const Ce=({className:e="",data:t})=>c.createElement("div",{className:`${Ee} ${e}`},c.createElement("div",{className:fe,"data-active":t.active?"true":"",onClick:e=>{t.onClick(t,e)}},t.content),c.createElement("div",{className:we},t.children.map((e=>c.createElement(Ce,{key:e.key,data:e}))))),ke=({className:e,data:t})=>c.createElement("div",{className:`${ve.tree_view} ${e}`},c.createElement("div",null,t.title),c.createElement("div",{className:ve.tree_items},t.items.map((e=>c.createElement(Ce,{key:e.key,data:e})))));class Ne{constructor(){this.title="",this.items=[]}static new(){const e=new Ne;return Ne.set(e)}static set(e){return{items(t){return e.items=[...e.items,...t],this},title(t){return e.title=t,this},done:()=>e}}}class be{constructor(){this.key="",this.content="",this.active=!1,this.children=[],this.onClick=()=>{}}static new(){const e=new be;return be.set(e)}static set(e){return{key(t){return e.key=t,this},children(t){return e.children=[...e.children,...t],this},content(t){return e.content=t,this},active(t){return e.active=t,this},onClick(t){return e.onClick=t,this},done:()=>e}}}const $e=e=>{const{years:t,path:n,onChangePath:a,onAddDiary:r,onAddMonth:o,onAddYear:s}=e,i=(e,o)=>be.new().key(`${e.index}`).content(`${e.index} ${e.title}`).active(o.index===n.year&&e.index===n.month&&n.date===1/0).onClick((()=>a((new le).set().year(o.index).month(e.index).done()))).children(e.diarys.map((t=>((e,t,r)=>be.new().key(`${e.index}`).content(`${e.index} ${e.title}`).active(r.index===n.year&&t.index===n.month&&e.index===n.date).onClick((()=>a((new le).set().year(r.index).month(t.index).date(e.index).done()))).done())(t,e,o)))).children([be.new().key("add").onClick((()=>{((e,t,n,a)=>{let r=1;e.filter((e=>e.index===t)).forEach((e=>{e.months.filter((e=>e.index===n)).forEach((e=>{0!==e.diarys.length&&(r=e.diarys[e.diarys.length-1].index+1)}))})),a((new le).set().year(t).month(n).date(r).done())})(t,o.index,e.index,r)})).content("+").done()]).done(),l=e=>be.new().key(`${e.index}`).content(`${e.index} ${e.title}`).active(e.index===n.year&&n.month===1/0).onClick((()=>a((new le).set().year(e.index).done()))).children(e.months.map((t=>i(t,e)))).children([be.new().key("add").onClick((()=>{((e,t,n)=>{let a=1;e.filter((e=>e.index===t)).forEach((e=>{0!==e.months.length&&(a=e.months[e.months.length-1].index+1)})),n((new le).set().year(t).month(a).done())})(t,e.index,o)})).content("+").done()]).done();return Ne.new().items(t.map((e=>l(e)))).items([be.new().key("add").onClick((()=>{((e,t)=>{let n=1;0!==e.length&&(n=e[e.length-1].index+1),t((new le).set().year(n).done())})(t,s)})).content("+").done()]).done()};var De="_catalog_1d5ym_1";const Se=e=>c.createElement(ke,{className:De,data:$e(e)}),Pe=()=>{const{yearIndexs:e,years:t,path:n,activeYearIndex:a,editTarget:r,editorHandle:o,bookName:s,passwordDialogShow:m,password:h,exportDialogShow:u,onBookNameChange:y,onImportFile:p,onHeaderExportFile:g,verifyPassword:x,hidePasswordDialog:_,hideExportDialog:v,dialogExportFile:E,changePath:f,onAddDiary:N,onAddMonth:b,onAddYear:$,onDeletePath:D}=(()=>{const[e,t]=d.exports.useState(new ie),[n,a]=d.exports.useState(0),[r,o]=d.exports.useState(!1),[s,c]=d.exports.useState(!1),[m,h]=d.exports.useState(new le),[u,y]=d.exports.useState(""),p=e.years||[],g=p.filter((e=>e.index===m.year)).shift(),x=(null==g?void 0:g.months)||[],_=x.filter((e=>e.index===m.month)).shift(),v=(null==_?void 0:_.diarys)||[],E=v.filter((e=>e.index===m.date)).shift(),f=p.map((e=>e.index)),w=e.bookName;0===p.length||p.map((e=>e.index)).includes(m.year)||h((new le).set().year(p.map((e=>e.index)).shift()||1/0).done());const C=m.year===1/0?"none":m.month===1/0?"year":m.date===1/0?"month":"diary",k={year:{title:n=>{g&&(g.title=n),t(i({},e))},tags:n=>{g&&(g.tags=n),t(i({},e))},summary:n=>{g&&(g.summary.data=n),t(i({},e))}},month:{title:n=>{_&&(_.title=n),t(i({},e))},tags:n=>{_&&(_.tags=n),t(i({},e))},summary:n=>{_&&(_.summary.data=n),t(i({},e))}},diary:{title:n=>{void 0!==E&&(E.title=n,t(i({},e)))},tags:n=>{void 0!==E&&(E.tags=n,t(i({},e)))},content:n=>{void 0!==E&&(E.content.data=n,t(i({},e)))}}},N={title:"year"===C?(null==g?void 0:g.title)||"":"month"===C?(null==_?void 0:_.title)||"":"diary"===C&&(null==E?void 0:E.title)||"",tags:"year"===C?(null==g?void 0:g.tags)||[]:"month"===C?(null==_?void 0:_.tags)||[]:"diary"===C&&(null==E?void 0:E.tags)||[],content:"year"===C?(null==g?void 0:g.summary.data)||"":"month"===C?(null==_?void 0:_.summary.data)||"":"diary"===C&&(null==E?void 0:E.content.data)||"",onTitleChange:"year"===C?k.year.title:"month"===C?k.month.title:"diary"===C?k.diary.title:()=>{},onTagsChange:"year"===C?k.year.tags:"month"===C?k.month.tags:"diary"===C?k.diary.tags:()=>{},onContentChange:"year"===C?k.year.summary:"month"===C?k.month.summary:"diary"===C?k.diary.content:()=>{},titleEditorPlaceholder:"year"===C?"年度总结标题":"month"===C?"月度总结标题":"diary"===C?"日记标题":""},b=e=>{h(e),a((e=>e+1))};return{yearIndexs:f,years:p,months:x,diarys:v,path:m,activeDiaryIndex:m.date,activeMonthIndex:m.month,activeYearIndex:m.year,editTarget:N,editorHandle:n,bookName:w,passwordDialogShow:r,password:e.password,exportDialogShow:s,onBookNameChange:n=>{t(l(i({},e),{bookName:n}))},onImportFile:e=>{y(e),o(!0)},onHeaderExportFile:()=>{c(!0)},verifyPassword:e=>{try{const n=ye(u,e);"object"==typeof n&&e===n.password&&t(n)}catch(n){t(new ie)}a((e=>e+1)),y("")},hidePasswordDialog:()=>{o(!1)},hideExportDialog:()=>{c(!1)},dialogExportFile:n=>{const a=l(i({},e),{password:n});t(a),pe(a)},changePath:b,onAddDiary:n=>{const a=i({},e);a.years.filter((e=>e.index===n.year)).forEach((e=>{e.months.filter((e=>e.index===n.month)).forEach((e=>{e.diarys.some((e=>e.index===n.date))?console.warn(`onAddDiary dateIdx=${n.date} 已存在`):(e.diarys.push(new re(n.date)),e.diarys.sort(((e,t)=>e.index-t.index)),t((e=>a)),b((new le).set().year(n.year).month(n.month).date(n.date).done()))}))}))},onAddMonth:n=>{const a=i({},e);a.years.filter((e=>e.index===n.year)).forEach((e=>{e.months.some((e=>e.index===n.month))?console.warn(`onAddDiary dateIdx=${n.month} 已存在`):(e.months.push(new oe(n.year,n.month)),e.months.sort(((e,t)=>e.index-t.index)),t((e=>a)),b((new le).set().year(n.year).month(n.month).done()))}))},onAddYear:n=>{const a=i({},e);a.years.some((e=>e.index===n.year))?console.warn(`onAddDiary dateIdx=${n.year} 已存在`):(a.years.push(new se(n.year)),a.years.sort(((e,t)=>e.index-t.index)),t((e=>a)),b((new le).set().year(n.year).done()))},onDeletePath:n=>{const a=i({},e),r=new le(n);n.year!==1/0&&(n.month===1/0?a.years=a.years.filter((e=>e.index!==n.year)):n.date===1/0?a.years.filter((e=>e.index===n.year)).forEach((e=>{e.months=e.months.filter((e=>e.index!==n.month))})):a.years.filter((e=>e.index===n.year)).forEach((e=>{e.months.filter((e=>e.index===n.month)).forEach((e=>{e.diarys=e.diarys.filter((e=>e.index!==n.date))}))})),t((e=>a)),b(r))}}})();return c.createElement("div",{id:"app",className:w},c.createElement(M,{activeYearIndex:a,yearIndexs:e,bookName:s,onBookNameChange:y,onImportFile:p,onExportFile:g}),c.createElement("main",{className:C},c.createElement("div",{className:k},c.createElement(Se,{years:t,path:n,onChangePath:f,onAddDiary:N,onAddMonth:b,onAddYear:$})),c.createElement(ne,{path:n,handle:o,title:r.title,tags:r.tags,content:r.content,titleEditorPlaceholder:r.titleEditorPlaceholder,onContentChange:r.onContentChange,onTagsChange:r.onTagsChange,onTitleChange:r.onTitleChange,onDeletePath:D})),c.createElement(xe,{isShow:m,hide:_,verify:x}),c.createElement(_e,{defaultPassword:h,show:u,hide:v,onExport:E}))};f.render(c.createElement(c.StrictMode,null,c.createElement(Pe,null)),document.getElementById("root"));
