var e,t,n,a,r,o,s,i,l,c,d,m,h,u,p,_=Object.defineProperty,y=Object.defineProperties,v=Object.getOwnPropertyDescriptors,x=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable,f=(e,t,n)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,w=(e,t)=>{for(var n in t||(t={}))g.call(t,n)&&f(e,n,t[n]);if(x)for(var n of x(t))E.call(t,n)&&f(e,n,t[n]);return e},k=(e,t)=>y(e,v(t)),N=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},C=(e,t,n)=>(N(e,t,"read from private field"),n?n.call(e):t.get(e)),S=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},b=(e,t,n,a)=>(N(e,t,"write to private field"),a?a.call(e,n):t.set(e,n),n);import{C as I,R as D,a as Y,b as T,c as M,u as P,D as $,d as O,e as F,P as W,f as A,g as R}from"./vendor.4f46c685.js";var L="_app_1u2a9_1",J="_main_1u2a9_15";var j="_text_editor_k39rm_1";class q{constructor(e,t,n){var a;this.evt=t,this.ele=e.current,this.text=(null==(a=e.current)?void 0:a.textContent)||"",this.defaultText=n}setTextContent(e){this.ele&&H(this.ele,e),this.ele&&B(this.ele)}}const B=e=>{const t=""===e.textContent;e.setAttribute("data-is-empty",t?"true":"false")},H=(e,t)=>{e.textContent=t||""},V=({defaultText:e,placeholder:t,className:n,disabled:a,onInput:r,onDoubleClick:o,onClick:s,onDisabled:i,onAbled:l})=>{const c=I.exports.createRef();return I.exports.useEffect((()=>{a?i&&i(new q(c,null,e||"")):l&&l(new q(c,null,e||""))}),[a]),I.exports.useEffect((()=>{c.current&&(H(c.current,e||""),B(c.current))}),[e]),D.createElement("div",{ref:c,className:`${j} ${n}`,contentEditable:a?"false":"true",placeholder:t,"data-is-empty":"false",onInput:t=>{c.current&&B(c.current),r&&r(new q(c,t,e||""))},onDoubleClick:t=>{o&&o(new q(c,t,e||""))},onClick:t=>{s&&s(new q(c,t,e||""))}})};var U="_file_controller_1c6r4_1",z="_name_editor_1c6r4_19",G="_file_input_control_1c6r4_65",K="_import_1c6r4_73",Q="_export_1c6r4_73";const X=({fileName:e,onFileNameChange:t,onImportFile:n,onExportFile:a})=>{const r=I.exports.createRef(),[o,s]=I.exports.useState(!1),i=()=>{document.removeEventListener("click",i),s(!1)},l=()=>{var e;if(!r.current)return;const t=r.current;if(!t.files||0===(null==(e=t.files)?void 0:e.length))return;const a=t.files[0],o=new FileReader;o.onload=()=>{"string"==typeof o.result&&n(o.result||""),t&&(t.value="")},o.readAsText(a)};return I.exports.useEffect((()=>{var e;return null==(e=r.current)||e.addEventListener("change",l),()=>{var e;null==(e=r.current)||e.removeEventListener("change",l)}})),D.createElement("div",{className:U},D.createElement(V,{className:z,defaultText:e,placeholder:"日记本名",disabled:!o,onClick:e=>{var t,n;o?null==(t=e.evt)||t.stopPropagation():e.evt&&e.ele&&(n=e.ele,e.evt.nativeEvent.stopPropagation(),document.addEventListener("click",i),s(!0),setTimeout((()=>{n.focus()})))},onDisabled:n=>{const a=n.text;""!==a?t(a):n.setTextContent(e)}}),D.createElement("label",{className:K},D.createElement("input",{ref:r,className:G,type:"file"}),D.createElement("div",null,"导入")),D.createElement("div",{className:Q,onClick:()=>{a()}},"导出"))};var Z="_header_u3ffk_1",ee="_background_u3ffk_33",te="_content_u3ffk_53";var ne="_years_editor_eqo8i_1",ae="_active_year_eqo8i_9",re="_dropdown_button_eqo8i_57",oe="_add_button_eqo8i_57",se="_delete_button_eqo8i_57",ie="_year_options_group_eqo8i_107",le="_placeholder_eqo8i_149",ce="_year_option_eqo8i_107";const de=({activeYearIndex:e,yearIndexs:t,onEditYearIndex:n,onSelectYear:a,onDeleteYear:r,onAddYear:o})=>{const[s,i]=I.exports.useState(!1),[l,c]=I.exports.useState(!1),d=t.filter((t=>t!==e)),m=()=>{document.removeEventListener("click",m),c(!1)},h=()=>{document.removeEventListener("click",h),i(!1)},u=e=>()=>{a(e)};return console.log("[YearsEditor Render]"),D.createElement("div",{className:ne},D.createElement("div",{className:ie,"data-show":s?"true":"false"},0===d.length?D.createElement("div",{className:le},"空"):d.map((e=>D.createElement("div",{key:e,className:ce,onClick:u(e)},e)))),D.createElement(V,{defaultText:`${e}`,className:ae,disabled:!l,onDoubleClick:e=>{var t;!l&&e.ele&&e.evt&&(t=e.ele,e.evt.nativeEvent.stopPropagation(),document.addEventListener("click",m),c(!0),setTimeout((()=>{t.focus()})))},onClick:t=>{var n;l?null==(n=t.evt)||n.stopPropagation():a(e)},onDisabled:t=>{const a=parseInt(t.text);`${a}`!==t.text||isNaN(a)||d.includes(a)?t.ele&&(t.ele.textContent=`${e}`):n(e,a)}}),D.createElement("div",{className:re,onClick:e=>{!s&&(e=>{e.stopPropagation(),document.addEventListener("click",h),i(!0)})(e.nativeEvent),l&&m()}},D.createElement("div",null,"")),D.createElement("div",{className:se,onClick:()=>{r(e)}},""),D.createElement("div",{className:oe,onClick:()=>{let e=(new Date).getFullYear();for(;t.includes(e);)e++;o(e)}},""))},me=({bookName:e,activeYearIndex:t,yearIndexs:n,onSelectYear:a,onEditYearIndex:r,onDeleteYear:o,onAddYear:s,onBookNameChange:i,onImportFile:l,onExportFile:c})=>(console.log("[Header Render]"),D.createElement("div",{className:Z},D.createElement("div",{className:ee}),D.createElement("div",{className:te},D.createElement(de,{activeYearIndex:t,yearIndexs:n,onEditYearIndex:r,onAddYear:s,onDeleteYear:o,onSelectYear:a}),D.createElement(X,{fileName:e,onFileNameChange:i,onImportFile:l,onExportFile:c}))));var he="_month_list_item_1rmkc_1",ue="_month_list_item_index_1rmkc_37",pe="_month_list_item_title_1rmkc_53";class _e{constructor(o=""){S(this,e,""),S(this,t,!1),S(this,n,0),S(this,a,""),S(this,r,(()=>{})),b(this,e,o)}onSelectMonth(e){return b(this,r,e),this}selected(e){return b(this,t,e),this}monthIndex(e){return b(this,n,e),this}monthTitle(e){return b(this,a,e),this}done(){return D.createElement("div",{key:C(this,e),className:`${he}`,onClick:C(this,r),"data-selected":C(this,t)?"true":"false"},D.createElement("div",{className:ue},C(this,n)),D.createElement("div",{className:pe},C(this,a)))}}e=new WeakMap,t=new WeakMap,n=new WeakMap,a=new WeakMap,r=new WeakMap;var ye="_month_list_17rsr_1";class ve{constructor(e=""){S(this,o,""),S(this,s,[]),S(this,i,0),S(this,l,(()=>{})),b(this,o,e)}months(e){return b(this,s,e),this}activeMonthIndex(e){return b(this,i,e),this}onSelectMonth(e){return b(this,l,e),this}done(){return D.createElement("div",{key:C(this,o),className:ye},C(this,s).map((e=>new _e(`${e.index}`).monthIndex(e.index).monthTitle(e.title).selected(e.index===C(this,i)).onSelectMonth((()=>C(this,l).call(this,e.index))).done())))}}o=new WeakMap,s=new WeakMap,i=new WeakMap,l=new WeakMap;var xe="_diary_list_1gxe0_1";var ge="_diary_list_item_i86tw_1",Ee="_diary_list_item_index_i86tw_37",fe="_diary_list_item_title_i86tw_53";const we=({diaryIndex:e,diaryTitle:t,selected:n,onClick:a})=>D.createElement("div",{className:ge,"data-selected":n?"true":"false",onClick:a},D.createElement("div",{className:Ee},e),D.createElement("div",{className:fe},t)),ke=({diarys:e,activeDiaryIndex:t,onSelectDiary:n})=>(console.log("[DiaryList Render]"),D.createElement("div",{className:xe},e.map((e=>D.createElement(we,{diaryIndex:e.index,diaryTitle:e.title,selected:e.index===t,onClick:()=>n(e.index),key:e.index})))));var Ne="_diary_page_1f4wp_1",Ce="_content_editor_1f4wp_19";var Se="_title_editor_1hgxa_1";const be=({handle:e,title:t,onChange:n,placeholder:a})=>{const[r,o]=I.exports.useState(t);return I.exports.useEffect((()=>{o(t)}),[e]),console.log("[TitleEditor Render]"),D.createElement(V,{key:e,defaultText:r,placeholder:a||"",className:Se,onInput:e=>{n&&n(e.text)}})};var Ie="_rich_text_editor_181tc_1";const De=({handle:e,initialHtmlContent:t,className:n,onChange:a})=>D.createElement(Y,{className:`${Ie} ${n}`,key:e,theme:"snow",defaultValue:t,onChange:e=>{a&&a(e)}});var Ye="_tag_gex5y_1",Te="_text_gex5y_25",Me="_delete_button_gex5y_43";const Pe=({target:e,text:t,onChange:n,onDelete:a})=>{const[r,o]=I.exports.useState(t);return I.exports.useEffect((()=>{o(t)}),[e]),D.createElement("div",{className:Ye},D.createElement(V,{key:e,defaultText:r,placeholder:"新标签",className:Te,onInput:e=>{n(e.text)}}),D.createElement("div",{className:Me,onClick:a},""))};var $e="_tags_bar_qrfca_1",Oe="_add_button_qrfca_25";const Fe=({tags:e,onTagsChange:t})=>{const n=n=>()=>{const a=e.filter(((e,t)=>t!==n));t(a)};return D.createElement("div",{className:$e},e.map(((a,r)=>{return D.createElement(Pe,{key:r,target:`${e.length}/${r}`,text:a,onChange:(o=r,n=>{const a=[...e];a[o]=n,t(a)}),onDelete:n(r)});var o})),D.createElement("div",{className:Oe,onClick:()=>{const n=[...e,""];t(n)}},""))};var We="_current_path_z5u7r_1";const Ae=({year:e,month:t,date:n})=>D.createElement("div",{className:We},D.createElement("div",null,e),0===t?void 0:D.createElement("div",null," / ",t),0===n?void 0:D.createElement("div",null," / ",n)),Re=({year:e,month:t,date:n,handle:a,title:r,tags:o,content:s,onTitleChange:i,onTagsChange:l,onContentChange:c,titleEditorPlaceholder:d})=>D.createElement("div",{className:Ne},D.createElement(Ae,{year:e,month:t,date:n}),D.createElement(be,{handle:a,title:r,onChange:i,placeholder:d}),D.createElement(Fe,{key:a,tags:o,onTagsChange:l}),D.createElement(De,{className:Ce,onChange:c,handle:a,initialHtmlContent:s})),Le=e=>{const t=JSON.parse(JSON.stringify(e));return k(w({},t),{years:t.years.map((e=>{const t=new Be(e.index,e.title,e.tags,e.summary);return e.months.map((e=>{const t=new qe(e.yearIndex,e.index,e.title,e.tags,e.summary);return e.diarys.forEach((e=>{t.diarys[e.index-1]=e})),t})).forEach((e=>{t.months[e.index-1]=e})),t}))})};class Je{constructor(e=""){this.data=e}}class je{constructor(e,t="",n=[],a=new Je("")){this.index=e,this.title=t,this.tags=n,this.content=a}}class qe{constructor(e,t,n="",a=[],r=new Je(""),o=Array(((e,t)=>{const n=[void 0,31,28,31,30,31,30,31,30,30,31,30,31];return(e%4==0&&e%100!=0||e%400==0)&&(n[2]=29),n[t]})(e,t)).fill(0).map(((e,t)=>new je(t+1)))){this.yearIndex=e,this.index=t,this.title=n,this.tags=a,this.summary=r,this.diarys=o}}class Be{constructor(e,t="",n=[],a=new Je(""),r=Array(12).fill(0).map(((t,n)=>new qe(e,n+1)))){this.index=e,this.title=t,this.tags=n,this.summary=a,this.months=r}}class He{constructor(e="新日记本",t=[new Be((new Date).getFullYear())],n=""){this.bookName=e,this.years=t,this.password=n}}const Ve="V1_JSON",Ue="V2_JSON",ze="V3_PASSWORD",Ge="V4_RC4",Ke=e=>{const t=(e=>{const t=JSON.parse(JSON.stringify(e));return k(w({},t),{years:t.years.map((e=>k(w({},e),{months:e.months.map((e=>k(w({},e),{diarys:e.diarys.filter((e=>!(""===e.content.data&&0===e.tags.length&&""===e.title)))}))).filter((e=>!(0===e.diarys.length&&""===e.summary.data&&0===e.tags.length&&""===e.title)))})))})})(e),n=T.encrypt(JSON.stringify(t),e.password).toString();return new Blob([Ge,";",n])},Qe=(e,t)=>{switch((e=>{if("{"===e[0])return Ve;const t=[];let n=0;for(;";"!==e[n];)t.push(e[n]),n++;return t.join("")})(e)){case Ve:return n=e,k(w({},JSON.parse(n)),{password:""});case Ue:return(e=>{const t=JSON.parse(e);return k(w({},Le(t)),{password:""})})(e.slice(Ue.length+1));case ze:return(e=>{const t=JSON.parse(e);return Le(t)})(e.slice(ze.length+1));case Ge:return((e,t)=>{const n=T.decrypt(e,t).toString(M.exports.enc.Utf8),a=JSON.parse(n);return Le(a)})(e.slice(Ge.length+1),t);default:return new He}var n},Xe=e=>{const t=Ke(e);((e,t)=>{const n=document.createElement("a");n.download=e,n.href=window.URL.createObjectURL(t),n.style.display="none",document.body.appendChild(n),n.click()})(`${e.bookName}-${(()=>{const e=new Date;return`${e.getFullYear()}${`0${e.getMonth()+1}`.slice(-2)}${`0${e.getDate()}`.slice(-2)}-${`0${e.getHours()}`.slice(-2)}${`0${e.getMinutes()}`.slice(-2)}${`0${e.getSeconds()}`.slice(-2)}`})()}.diary`,t)};class Ze{constructor(e=""){S(this,c,""),S(this,d,[]),S(this,m,[]),S(this,h,!0),S(this,u,"对话框"),S(this,p,(()=>{})),b(this,c,e)}title(e){return b(this,u,e),this}content(...e){return b(this,d,C(this,d).concat(e)),this}footer(...e){return b(this,m,C(this,m).concat(e)),this}show(e){return b(this,h,e),this}onDismiss(e){return b(this,p,e),this}done(){const e=P("dialogLabel"),t=P("subTextLabel"),n=I.exports.useMemo((()=>({titleAriaId:e,subtitleAriaId:t,isBlocking:!1,styles:{main:{maxWidth:450}}})),[e,t]),a={type:$.normal,title:C(this,u),closeButtonAriaLabel:"关闭"};return D.createElement("div",{key:C(this,c),style:{position:"fixed"}},D.createElement(O,{hidden:!C(this,h),onDismiss:C(this,p),dialogContentProps:a,modalProps:n},C(this,d).length<=1?C(this,d)[0]:C(this,d),D.createElement(F,null,C(this,m).length<=1?C(this,m)[0]:C(this,m))))}}c=new WeakMap,d=new WeakMap,m=new WeakMap,h=new WeakMap,u=new WeakMap,p=new WeakMap;const et=({isShow:e,hide:t,verify:n})=>{const a=I.exports.createRef(),r=()=>{a.current&&(a.current.value=""),t()},o=r;return(new Ze).title("输入密码").content(D.createElement("input",{ref:a,type:"password"})).footer(D.createElement(W,{key:"ok",onClick:()=>{a.current&&n(a.current.value),t()},text:"确定"}),D.createElement(A,{key:"cancel",onClick:r,text:"取消"})).onDismiss(o).show(e).done()},tt=({defaultPassword:e,show:t,hide:n,onExport:a})=>{const r=I.exports.createRef(),o=()=>{r.current&&(r.current.value=""),n()};return I.exports.useEffect((()=>{setTimeout((()=>{!0===t&&r.current&&(r.current.value=e)}))}),[t]),(new Ze).title("设置密码").content(D.createElement(D.Fragment,null,D.createElement("p",null,"以下自动填充当前密码，如无需修改，请直接确认导出。"),D.createElement("input",{ref:r,type:"password"}))).footer(D.createElement(W,{key:"ok",onClick:()=>{r.current&&a(r.current.value),n()},text:"确定"}),D.createElement(A,{key:"cancel",onClick:o,text:"取消"})).onDismiss(o).show(t).done()},nt=()=>{const{yearIndexs:e,months:t,diarys:n,activeYearIndex:a,activeDiaryIndex:r,activeMonthIndex:o,editTarget:s,editorHandle:i,bookName:l,passwordDialogShow:c,password:d,exportDialogShow:m,onSelectYear:h,onSelectMonth:u,onSelectDiary:p,onEditYearIndex:_,onDeleteYear:y,onAddYear:v,onBookNameChange:x,onImportFile:g,onHeaderExportFile:E,verifyPassword:f,hidePasswordDialog:N,hideExportDialog:C,dialogExportFile:S}=(()=>{const[e,t]=I.exports.useState(new He),[n,a]=I.exports.useState(1/0),[r,o]=I.exports.useState(0),[s,i]=I.exports.useState(0),[l,c]=I.exports.useState(0),[d,m]=I.exports.useState(!1),[h,u]=I.exports.useState(!1),[p,_]=I.exports.useState(""),y=e.years||[],v=y.filter((e=>e.index===n)).shift(),x=(null==v?void 0:v.months)||[],g=x[r-1],E=(null==g?void 0:g.diarys)||[],f=E[s-1],N=y.map((e=>e.index)),C=e.bookName;0===y.length||y.map((e=>e.index)).includes(n)||a(y.map((e=>e.index)).shift()||1/0);const S=0===n?"none":0===r?"year":0===s?"month":"diary",b={year:{title:n=>{v&&(v.title=n),t(w({},e))},tags:n=>{v&&(v.tags=n),t(w({},e))},summary:n=>{v&&(v.summary.data=n),t(w({},e))}},month:{title:n=>{g&&(g.title=n),t(w({},e))},tags:n=>{g&&(g.tags=n),t(w({},e))},summary:n=>{g&&(g.summary.data=n),t(w({},e))}},diary:{title:n=>{void 0!==f&&(f.title=n,t(w({},e)))},tags:n=>{void 0!==f&&(f.tags=n,t(w({},e)))},content:n=>{void 0!==f&&(f.content.data=n,t(w({},e)))}}},D={title:"year"===S?(null==v?void 0:v.title)||"":"month"===S?(null==g?void 0:g.title)||"":"diary"===S&&(null==f?void 0:f.title)||"",tags:"year"===S?(null==v?void 0:v.tags)||[]:"month"===S?(null==g?void 0:g.tags)||[]:"diary"===S&&(null==f?void 0:f.tags)||[],content:"year"===S?(null==v?void 0:v.summary.data)||"":"month"===S?(null==g?void 0:g.summary.data)||"":"diary"===S&&(null==f?void 0:f.content.data)||"",onTitleChange:"year"===S?b.year.title:"month"===S?b.month.title:"diary"===S?b.diary.title:()=>{},onTagsChange:"year"===S?b.year.tags:"month"===S?b.month.tags:"diary"===S?b.diary.tags:()=>{},onContentChange:"year"===S?b.year.summary:"month"===S?b.month.summary:"diary"===S?b.diary.content:()=>{},titleEditorPlaceholder:"year"===S?"年度总结标题":"month"===S?"月度总结标题":"diary"===S?"日记标题":""};return{yearIndexs:N,months:x,diarys:E,activeDiaryIndex:s,activeMonthIndex:r,activeYearIndex:n,editTarget:D,editorHandle:l,bookName:C,passwordDialogShow:d,password:e.password,exportDialogShow:h,onSelectYear:e=>{c((e=>e+1)),i(0),o(0),a(e)},onSelectMonth:e=>{c((e=>e+1)),i(0),o(e)},onSelectDiary:e=>{c((e=>e+1)),i(e)},onEditYearIndex:(n,r)=>{const s=y.filter((e=>e.index===n)).shift();null!=s&&(s.index=r,y.sort(((e,t)=>e.index-t.index)),t(w({},e)),i(0),o(0),a(r),c((e=>e+1)))},onDeleteYear:n=>{var r;const s=y.filter((e=>e.index!==n));t(k(w({},e),{years:s})),i(0),o(0),a((null==(r=y[0])?void 0:r.index)||1/0),c((e=>e+1))},onAddYear:n=>{const r=[...y];r.push(new Be(n)),r.sort(((e,t)=>e.index-t.index)),t(k(w({},e),{years:r})),i(0),o(0),a(n),c((e=>e+1))},onBookNameChange:n=>{t(k(w({},e),{bookName:n}))},onImportFile:e=>{_(e),m(!0)},onHeaderExportFile:()=>{u(!0)},verifyPassword:e=>{try{const n=Qe(p,e);"object"==typeof n&&e===n.password&&t(n)}catch(n){t(new He)}c((e=>e+1)),_("")},hidePasswordDialog:()=>{m(!1)},hideExportDialog:()=>{u(!1)},dialogExportFile:n=>{const a=k(w({},e),{password:n});t(a),Xe(a)}}})();return console.log("[App Render]"),D.createElement("div",{id:"app",className:L},D.createElement(me,{activeYearIndex:a,yearIndexs:e,bookName:l,onSelectYear:h,onEditYearIndex:_,onDeleteYear:y,onAddYear:v,onBookNameChange:x,onImportFile:g,onExportFile:E}),D.createElement("main",{className:J},(new ve).activeMonthIndex(o).months(t).onSelectMonth(u).done(),0===o?void 0:D.createElement(ke,{diarys:n,activeDiaryIndex:r,onSelectDiary:p}),D.createElement(Re,{year:a,month:o,date:r,handle:i,title:s.title,tags:s.tags,content:s.content,titleEditorPlaceholder:s.titleEditorPlaceholder,onContentChange:s.onContentChange,onTagsChange:s.onTagsChange,onTitleChange:s.onTitleChange})),D.createElement(et,{isShow:c,hide:N,verify:f}),D.createElement(tt,{defaultPassword:d,show:m,hide:C,onExport:S}))};R.render(D.createElement(D.StrictMode,null,D.createElement(nt,null)),document.getElementById("root"));
