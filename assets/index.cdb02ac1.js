var e,t,n,a,r,o,s=Object.defineProperty,l=Object.defineProperties,i=Object.getOwnPropertyDescriptors,c=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,h=(e,t,n)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,u=(e,t)=>{for(var n in t||(t={}))d.call(t,n)&&h(e,n,t[n]);if(c)for(var n of c(t))m.call(t,n)&&h(e,n,t[n]);return e},p=(e,t)=>l(e,i(t)),y=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},_=(e,t,n)=>(y(e,t,"read from private field"),n?n.call(e):t.get(e)),v=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},x=(e,t,n,a)=>(y(e,t,"write to private field"),a?a.call(e,n):t.set(e,n),n);import{C as g,R as E,a as f,b as w,c as k,u as C,D as N,d as b,e as S,P as I,f as D,g as Y}from"./vendor.4f46c685.js";var T="_app_aohfl_1";var P="_text_editor_k39rm_1";class ${constructor(e,t,n){var a;this.evt=t,this.ele=e.current,this.text=(null==(a=e.current)?void 0:a.textContent)||"",this.defaultText=n}setTextContent(e){this.ele&&F(this.ele,e),this.ele&&O(this.ele)}}const O=e=>{const t=""===e.textContent;e.setAttribute("data-is-empty",t?"true":"false")},F=(e,t)=>{e.textContent=t||""},M=({defaultText:e,placeholder:t,className:n,disabled:a,onInput:r,onDoubleClick:o,onClick:s,onDisabled:l,onAbled:i})=>{const c=g.exports.createRef();return g.exports.useEffect((()=>{a?l&&l(new $(c,null,e||"")):i&&i(new $(c,null,e||""))}),[a]),g.exports.useEffect((()=>{c.current&&(F(c.current,e||""),O(c.current))}),[e]),E.createElement("div",{ref:c,className:`${P} ${n}`,contentEditable:a?"false":"true",placeholder:t,"data-is-empty":"false",onInput:t=>{c.current&&O(c.current),r&&r(new $(c,t,e||""))},onDoubleClick:t=>{o&&o(new $(c,t,e||""))},onClick:t=>{s&&s(new $(c,t,e||""))}})};var j="_file_controller_1cjwy_1",A="_name_editor_1cjwy_21",R="_file_input_control_1cjwy_67",L="_import_1cjwy_75",J="_export_1cjwy_75";const W=({fileName:e,onFileNameChange:t,onImportFile:n,onExportFile:a})=>{const r=g.exports.createRef(),[o,s]=g.exports.useState(!1),l=()=>{document.removeEventListener("click",l),s(!1)},i=()=>{var e;if(!r.current)return;const t=r.current;if(!t.files||0===(null==(e=t.files)?void 0:e.length))return;const a=t.files[0],o=new FileReader;o.onload=()=>{"string"==typeof o.result&&n(o.result||""),t&&(t.value="")},o.readAsText(a)};return g.exports.useEffect((()=>{var e;return null==(e=r.current)||e.addEventListener("change",i),()=>{var e;null==(e=r.current)||e.removeEventListener("change",i)}})),E.createElement("div",{className:j},E.createElement(M,{className:A,defaultText:e,placeholder:"日记本名",disabled:!o,onClick:e=>{var t,n;o?null==(t=e.evt)||t.stopPropagation():e.evt&&e.ele&&(n=e.ele,e.evt.nativeEvent.stopPropagation(),document.addEventListener("click",l),s(!0),setTimeout((()=>{n.focus()})))},onDisabled:n=>{const a=n.text;""!==a?t(a):n.setTextContent(e)}}),E.createElement("label",{className:L},E.createElement("input",{ref:r,className:R,type:"file"}),E.createElement("div",null,"导入")),E.createElement("div",{className:J,onClick:()=>{a()}},"导出"))};var B="_header_1n6fy_1";var H="_years_editor_b3prp_1",V="_active_year_b3prp_9",U="_dropdown_button_b3prp_57",q="_add_button_b3prp_57",z="_delete_button_b3prp_57",G="_year_options_group_b3prp_107",K="_placeholder_b3prp_149",Q="_year_option_b3prp_107";const X=({activeYearIndex:e,yearIndexs:t,onEditYearIndex:n,onSelectYear:a,onDeleteYear:r,onAddYear:o})=>{const[s,l]=g.exports.useState(!1),[i,c]=g.exports.useState(!1),d=t.filter((t=>t!==e)),m=()=>{document.removeEventListener("click",m),c(!1)},h=()=>{document.removeEventListener("click",h),l(!1)},u=e=>()=>{a(e)};return console.log("[YearsEditor Render]"),E.createElement("div",{className:H},E.createElement("div",{className:G,"data-show":s?"true":"false"},0===d.length?E.createElement("div",{className:K},"空"):d.map((e=>E.createElement("div",{key:e,className:Q,onClick:u(e)},e)))),E.createElement(M,{defaultText:`${e}`,className:V,disabled:!i,onDoubleClick:e=>{var t;!i&&e.ele&&e.evt&&(t=e.ele,e.evt.nativeEvent.stopPropagation(),document.addEventListener("click",m),c(!0),setTimeout((()=>{t.focus()})))},onClick:t=>{var n;i?null==(n=t.evt)||n.stopPropagation():a(e)},onDisabled:t=>{const a=parseInt(t.text);`${a}`!==t.text||isNaN(a)||d.includes(a)?t.ele&&(t.ele.textContent=`${e}`):n(e,a)}}),E.createElement("div",{className:U,onClick:e=>{!s&&(e=>{e.stopPropagation(),document.addEventListener("click",h),l(!0)})(e.nativeEvent),i&&m()}},E.createElement("div",null,"")),E.createElement("div",{className:z,onClick:()=>{r(e)}},""),E.createElement("div",{className:q,onClick:()=>{let e=(new Date).getFullYear();for(;t.includes(e);)e++;o(e)}},""))},Z=({bookName:e,activeYearIndex:t,yearIndexs:n,onSelectYear:a,onEditYearIndex:r,onDeleteYear:o,onAddYear:s,onBookNameChange:l,onImportFile:i,onExportFile:c})=>(console.log("[Header Render]"),E.createElement("div",{className:B},E.createElement(X,{activeYearIndex:t,yearIndexs:n,onEditYearIndex:r,onAddYear:s,onDeleteYear:o,onSelectYear:a}),E.createElement(W,{fileName:e,onFileNameChange:l,onImportFile:i,onExportFile:c})));var ee="_month_list_item_5k1fa_1",te="_month_list_item_index_5k1fa_47",ne="_month_list_item_title_5k1fa_63";const ae=({monthIndex:e,monthTitle:t,selected:n,onSelectMonth:a})=>E.createElement("div",{className:`${ee}`,onClick:a,"data-selected":n?"true":"false"},E.createElement("div",{className:te},e),E.createElement("div",{className:ne},t));var re="_month_list_kdvn8_1";const oe=({months:e,activeMonthIndex:t,onSelectMonth:n})=>(console.log("[MonthList Render]"),E.createElement("div",{className:re},e.map((e=>E.createElement(ae,{monthIndex:e.index,monthTitle:e.title,selected:e.index===t,onSelectMonth:()=>n(e.index),key:e.index})))));var se="_diary_list_mf5ep_1";var le="_diary_list_item_7jkw0_1",ie="_diary_list_item_index_7jkw0_47",ce="_diary_list_item_title_7jkw0_63";const de=({diaryIndex:e,diaryTitle:t,selected:n,onClick:a})=>E.createElement("div",{className:le,"data-selected":n?"true":"false",onClick:a},E.createElement("div",{className:ie},e),E.createElement("div",{className:ce},t)),me=({diarys:e,activeDiaryIndex:t,onSelectDiary:n})=>(console.log("[DiaryList Render]"),E.createElement("div",{className:se},e.map((e=>E.createElement(de,{diaryIndex:e.index,diaryTitle:e.title,selected:e.index===t,onClick:()=>n(e.index),key:e.index})))));var he="_diary_page_1dkjo_1",ue="_content_editor_1dkjo_27";var pe="_title_editor_1hgxa_1";const ye=({handle:e,title:t,onChange:n,placeholder:a})=>{const[r,o]=g.exports.useState(t);return g.exports.useEffect((()=>{o(t)}),[e]),console.log("[TitleEditor Render]"),E.createElement(M,{key:e,defaultText:r,placeholder:a||"",className:pe,onInput:e=>{n&&n(e.text)}})};var _e="_rich_text_editor_13nt0_1";const ve=({handle:e,initialHtmlContent:t,className:n,onChange:a})=>E.createElement(f,{className:`${_e} ${n}`,key:e,theme:"snow",defaultValue:t,onChange:e=>{a&&a(e)}});var xe="_tag_gex5y_1",ge="_text_gex5y_25",Ee="_delete_button_gex5y_43";const fe=({target:e,text:t,onChange:n,onDelete:a})=>{const[r,o]=g.exports.useState(t);return g.exports.useEffect((()=>{o(t)}),[e]),E.createElement("div",{className:xe},E.createElement(M,{key:e,defaultText:r,placeholder:"新标签",className:ge,onInput:e=>{n(e.text)}}),E.createElement("div",{className:Ee,onClick:a},""))};var we="_tags_bar_qrfca_1",ke="_add_button_qrfca_25";const Ce=({tags:e,onTagsChange:t})=>{const n=n=>()=>{const a=e.filter(((e,t)=>t!==n));t(a)};return E.createElement("div",{className:we},e.map(((a,r)=>{return E.createElement(fe,{key:r,target:`${e.length}/${r}`,text:a,onChange:(o=r,n=>{const a=[...e];a[o]=n,t(a)}),onDelete:n(r)});var o})),E.createElement("div",{className:ke,onClick:()=>{const n=[...e,""];t(n)}},""))};var Ne="_current_path_z5u7r_1";const be=({year:e,month:t,date:n})=>E.createElement("div",{className:Ne},E.createElement("div",null,e),0===t?void 0:E.createElement("div",null," / ",t),0===n?void 0:E.createElement("div",null," / ",n)),Se=({year:e,month:t,date:n,handle:a,title:r,tags:o,content:s,onTitleChange:l,onTagsChange:i,onContentChange:c,titleEditorPlaceholder:d})=>E.createElement("div",{className:he},E.createElement(be,{year:e,month:t,date:n}),E.createElement(ye,{handle:a,title:r,onChange:l,placeholder:d}),E.createElement(Ce,{key:a,tags:o,onTagsChange:i}),E.createElement(ve,{className:ue,onChange:c,handle:a,initialHtmlContent:s})),Ie=e=>{const t=JSON.parse(JSON.stringify(e));return p(u({},t),{years:t.years.map((e=>{const t=new Pe(e.index,e.title,e.tags,e.summary);return e.months.map((e=>{const t=new Te(e.yearIndex,e.index,e.title,e.tags,e.summary);return e.diarys.forEach((e=>{t.diarys[e.index-1]=e})),t})).forEach((e=>{t.months[e.index-1]=e})),t}))})};class De{constructor(e=""){this.data=e}}class Ye{constructor(e,t="",n=[],a=new De("")){this.index=e,this.title=t,this.tags=n,this.content=a}}class Te{constructor(e,t,n="",a=[],r=new De(""),o=Array(((e,t)=>{const n=[void 0,31,28,31,30,31,30,31,30,30,31,30,31];return(e%4==0&&e%100!=0||e%400==0)&&(n[2]=29),n[t]})(e,t)).fill(0).map(((e,t)=>new Ye(t+1)))){this.yearIndex=e,this.index=t,this.title=n,this.tags=a,this.summary=r,this.diarys=o}}class Pe{constructor(e,t="",n=[],a=new De(""),r=Array(12).fill(0).map(((t,n)=>new Te(e,n+1)))){this.index=e,this.title=t,this.tags=n,this.summary=a,this.months=r}}class $e{constructor(e="新日记本",t=[new Pe((new Date).getFullYear())],n=""){this.bookName=e,this.years=t,this.password=n}}const Oe="V1_JSON",Fe="V2_JSON",Me="V3_PASSWORD",je="V4_RC4",Ae=e=>{const t=(e=>{const t=JSON.parse(JSON.stringify(e));return p(u({},t),{years:t.years.map((e=>p(u({},e),{months:e.months.map((e=>p(u({},e),{diarys:e.diarys.filter((e=>!(""===e.content.data&&0===e.tags.length&&""===e.title)))}))).filter((e=>!(0===e.diarys.length&&""===e.summary.data&&0===e.tags.length&&""===e.title)))})))})})(e),n=w.encrypt(JSON.stringify(t),e.password).toString();return new Blob([je,";",n])},Re=(e,t)=>{switch((e=>{if("{"===e[0])return Oe;const t=[];let n=0;for(;";"!==e[n];)t.push(e[n]),n++;return t.join("")})(e)){case Oe:return n=e,p(u({},JSON.parse(n)),{password:""});case Fe:return(e=>{const t=JSON.parse(e);return p(u({},Ie(t)),{password:""})})(e.slice(Fe.length+1));case Me:return(e=>{const t=JSON.parse(e);return Ie(t)})(e.slice(Me.length+1));case je:return((e,t)=>{const n=w.decrypt(e,t).toString(k.exports.enc.Utf8),a=JSON.parse(n);return Ie(a)})(e.slice(je.length+1),t);default:return new $e}var n},Le=e=>{const t=Ae(e);((e,t)=>{const n=document.createElement("a");n.download=e,n.href=window.URL.createObjectURL(t),n.style.display="none",document.body.appendChild(n),n.click()})(`${e.bookName}-${(()=>{const e=new Date;return`${e.getFullYear()}${`0${e.getMonth()+1}`.slice(-2)}${`0${e.getDate()}`.slice(-2)}-${`0${e.getHours()}`.slice(-2)}${`0${e.getMinutes()}`.slice(-2)}${`0${e.getSeconds()}`.slice(-2)}`})()}.diary`,t)};class Je{constructor(s=""){v(this,e,""),v(this,t,[]),v(this,n,[]),v(this,a,!0),v(this,r,"对话框"),v(this,o,(()=>{})),x(this,e,s)}title(e){return x(this,r,e),this}content(...e){return x(this,t,_(this,t).concat(e)),this}footer(...e){return x(this,n,_(this,n).concat(e)),this}show(e){return x(this,a,e),this}onDismiss(e){return x(this,o,e),this}done(){const s=C("dialogLabel"),l=C("subTextLabel"),i=g.exports.useMemo((()=>({titleAriaId:s,subtitleAriaId:l,isBlocking:!1,styles:{main:{maxWidth:450}}})),[s,l]),c={type:N.normal,title:_(this,r),closeButtonAriaLabel:"关闭"};return E.createElement("div",{key:_(this,e),style:{position:"fixed"}},E.createElement(b,{hidden:!_(this,a),onDismiss:_(this,o),dialogContentProps:c,modalProps:i},_(this,t).length<=1?_(this,t)[0]:_(this,t),E.createElement(S,null,_(this,n).length<=1?_(this,n)[0]:_(this,n))))}}e=new WeakMap,t=new WeakMap,n=new WeakMap,a=new WeakMap,r=new WeakMap,o=new WeakMap;const We=({isShow:e,hide:t,verify:n})=>{const a=g.exports.createRef(),r=()=>{a.current&&(a.current.value=""),t()},o=r;return(new Je).title("输入密码").content(E.createElement("input",{ref:a,type:"password"})).footer(E.createElement(I,{key:"ok",onClick:()=>{a.current&&n(a.current.value),t()},text:"确定"}),E.createElement(D,{key:"cancel",onClick:r,text:"取消"})).onDismiss(o).show(e).done()},Be=({defaultPassword:e,show:t,hide:n,onExport:a})=>{const r=g.exports.createRef(),o=()=>{r.current&&(r.current.value=""),n()};return g.exports.useEffect((()=>{setTimeout((()=>{!0===t&&r.current&&(r.current.value=e)}))}),[t]),(new Je).title("设置密码").content(E.createElement(E.Fragment,null,E.createElement("p",null,"以下自动填充当前密码，如无需修改，请直接确认导出。"),E.createElement("input",{ref:r,type:"password"}))).footer(E.createElement(I,{key:"ok",onClick:()=>{r.current&&a(r.current.value),n()},text:"确定"}),E.createElement(D,{key:"cancel",onClick:o,text:"取消"})).onDismiss(o).show(t).done()},He=()=>{const{yearIndexs:e,months:t,diarys:n,activeYearIndex:a,activeDiaryIndex:r,activeMonthIndex:o,editTarget:s,editorHandle:l,bookName:i,passwordDialogShow:c,password:d,exportDialogShow:m,onSelectYear:h,onSelectMonth:y,onSelectDiary:_,onEditYearIndex:v,onDeleteYear:x,onAddYear:f,onBookNameChange:w,onImportFile:k,onHeaderExportFile:C,verifyPassword:N,hidePasswordDialog:b,hideExportDialog:S,dialogExportFile:I}=(()=>{const[e,t]=g.exports.useState(new $e),[n,a]=g.exports.useState(1/0),[r,o]=g.exports.useState(0),[s,l]=g.exports.useState(0),[i,c]=g.exports.useState(0),[d,m]=g.exports.useState(!1),[h,y]=g.exports.useState(!1),[_,v]=g.exports.useState(""),x=e.years||[],E=x.filter((e=>e.index===n)).shift(),f=(null==E?void 0:E.months)||[],w=f[r-1],k=(null==w?void 0:w.diarys)||[],C=k[s-1],N=x.map((e=>e.index)),b=e.bookName;0===x.length||x.map((e=>e.index)).includes(n)||a(x.map((e=>e.index)).shift()||1/0);const S=0===n?"none":0===r?"year":0===s?"month":"diary",I={year:{title:n=>{E&&(E.title=n),t(u({},e))},tags:n=>{E&&(E.tags=n),t(u({},e))},summary:n=>{E&&(E.summary.data=n),t(u({},e))}},month:{title:n=>{w&&(w.title=n),t(u({},e))},tags:n=>{w&&(w.tags=n),t(u({},e))},summary:n=>{w&&(w.summary.data=n),t(u({},e))}},diary:{title:n=>{void 0!==C&&(C.title=n,t(u({},e)))},tags:n=>{void 0!==C&&(C.tags=n,t(u({},e)))},content:n=>{void 0!==C&&(C.content.data=n,t(u({},e)))}}},D={title:"year"===S?(null==E?void 0:E.title)||"":"month"===S?(null==w?void 0:w.title)||"":"diary"===S&&(null==C?void 0:C.title)||"",tags:"year"===S?(null==E?void 0:E.tags)||[]:"month"===S?(null==w?void 0:w.tags)||[]:"diary"===S&&(null==C?void 0:C.tags)||[],content:"year"===S?(null==E?void 0:E.summary.data)||"":"month"===S?(null==w?void 0:w.summary.data)||"":"diary"===S&&(null==C?void 0:C.content.data)||"",onTitleChange:"year"===S?I.year.title:"month"===S?I.month.title:"diary"===S?I.diary.title:()=>{},onTagsChange:"year"===S?I.year.tags:"month"===S?I.month.tags:"diary"===S?I.diary.tags:()=>{},onContentChange:"year"===S?I.year.summary:"month"===S?I.month.summary:"diary"===S?I.diary.content:()=>{},titleEditorPlaceholder:"year"===S?"年度总结标题":"month"===S?"月度总结标题":"diary"===S?"日记标题":""};return{yearIndexs:N,months:f,diarys:k,activeDiaryIndex:s,activeMonthIndex:r,activeYearIndex:n,editTarget:D,editorHandle:i,bookName:b,passwordDialogShow:d,password:e.password,exportDialogShow:h,onSelectYear:e=>{c((e=>e+1)),l(0),o(0),a(e)},onSelectMonth:e=>{c((e=>e+1)),l(0),o(e)},onSelectDiary:e=>{c((e=>e+1)),l(e)},onEditYearIndex:(n,r)=>{const s=x.filter((e=>e.index===n)).shift();null!=s&&(s.index=r,x.sort(((e,t)=>e.index-t.index)),t(u({},e)),l(0),o(0),a(r),c((e=>e+1)))},onDeleteYear:n=>{var r;const s=x.filter((e=>e.index!==n));t(p(u({},e),{years:s})),l(0),o(0),a((null==(r=x[0])?void 0:r.index)||1/0),c((e=>e+1))},onAddYear:n=>{const r=[...x];r.push(new Pe(n)),r.sort(((e,t)=>e.index-t.index)),t(p(u({},e),{years:r})),l(0),o(0),a(n),c((e=>e+1))},onBookNameChange:n=>{t(p(u({},e),{bookName:n}))},onImportFile:e=>{v(e),m(!0)},onHeaderExportFile:()=>{y(!0)},verifyPassword:e=>{try{const n=Re(_,e);"object"==typeof n&&e===n.password&&t(n)}catch(n){t(new $e)}c((e=>e+1)),v("")},hidePasswordDialog:()=>{m(!1)},hideExportDialog:()=>{y(!1)},dialogExportFile:n=>{const a=p(u({},e),{password:n});t(a),Le(a)}}})();return console.log("[App Render]"),E.createElement("div",{id:"app",className:T},E.createElement(Z,{activeYearIndex:a,yearIndexs:e,bookName:i,onSelectYear:h,onEditYearIndex:v,onDeleteYear:x,onAddYear:f,onBookNameChange:w,onImportFile:k,onExportFile:C}),E.createElement(oe,{months:t,activeMonthIndex:o,onSelectMonth:y}),0===o?void 0:E.createElement(me,{diarys:n,activeDiaryIndex:r,onSelectDiary:_}),E.createElement(Se,{year:a,month:o,date:r,handle:l,title:s.title,tags:s.tags,content:s.content,titleEditorPlaceholder:s.titleEditorPlaceholder,onContentChange:s.onContentChange,onTagsChange:s.onTagsChange,onTitleChange:s.onTitleChange}),E.createElement(We,{isShow:c,hide:b,verify:N}),E.createElement(Be,{defaultPassword:d,show:m,hide:S,onExport:I}))};Y.render(E.createElement(E.StrictMode,null,E.createElement(He,null)),document.getElementById("root"));
