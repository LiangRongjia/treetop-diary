var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,s=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&l(e,n,t[n]);if(a)for(var n of a(t))o.call(t,n)&&l(e,n,t[n]);return e},i=(e,a)=>t(e,n(a));import{C as c,R as d,a as m,D as u,u as h,b as _,c as p,P as y,d as v,e as x}from"./vendor.7033fbc1.js";var g="_app_aohfl_1";var E="_text_editor_k39rm_1";class f{constructor(e,t,n){var a;this.evt=t,this.ele=e.current,this.text=(null==(a=e.current)?void 0:a.textContent)||"",this.defaultText=n}setTextContent(e){this.ele&&C(this.ele,e),this.ele&&N(this.ele)}}const N=e=>{const t=""===e.textContent;e.setAttribute("data-is-empty",t?"true":"false")},C=(e,t)=>{e.textContent=t||""},w=({defaultText:e,placeholder:t,className:n,disabled:a,onInput:r,onDoubleClick:o,onClick:l,onDisabled:s,onAbled:i})=>{const m=c.exports.createRef();return c.exports.useEffect((()=>{a?s&&s(new f(m,null,e||"")):i&&i(new f(m,null,e||""))}),[a]),c.exports.useEffect((()=>{m.current&&(C(m.current,e||""),N(m.current))}),[e]),d.createElement("div",{ref:m,className:`${E} ${n}`,contentEditable:a?"false":"true",placeholder:t,"data-is-empty":"false",onInput:t=>{m.current&&N(m.current),r&&r(new f(m,t,e||""))},onDoubleClick:t=>{o&&o(new f(m,t,e||""))},onClick:t=>{l&&l(new f(m,t,e||""))}})};var k="_file_controller_1cjwy_1",b="_name_editor_1cjwy_21",I="_file_input_control_1cjwy_67",S="_import_1cjwy_75",D="_export_1cjwy_75";const Y=({fileName:e,onFileNameChange:t,onImportFile:n,onExportFile:a})=>{const r=c.exports.createRef(),[o,l]=c.exports.useState(!1),s=()=>{document.removeEventListener("click",s),l(!1)},i=()=>{var e;if(!r.current)return;const t=r.current;if(!t.files||0===(null==(e=t.files)?void 0:e.length))return;const a=t.files[0],o=new FileReader;o.onload=()=>{"string"==typeof o.result&&n(o.result||""),t&&(t.value="")},o.readAsText(a)};return c.exports.useEffect((()=>{var e;return null==(e=r.current)||e.addEventListener("change",i),()=>{var e;null==(e=r.current)||e.removeEventListener("change",i)}})),d.createElement("div",{className:k},d.createElement(w,{className:b,defaultText:e,placeholder:"日记本名",disabled:!o,onClick:e=>{var t,n;o?null==(t=e.evt)||t.stopPropagation():e.evt&&e.ele&&(n=e.ele,e.evt.nativeEvent.stopPropagation(),document.addEventListener("click",s),l(!0),setTimeout((()=>{n.focus()})))},onDisabled:n=>{const a=n.text;""!==a?t(a):n.setTextContent(e)}}),d.createElement("label",{className:S},d.createElement("input",{ref:r,className:I,type:"file"}),d.createElement("div",null,"导入")),d.createElement("div",{className:D,onClick:()=>{a()}},"导出"))};var T="_header_1n6fy_1";var $="_years_editor_b3prp_1",P="_active_year_b3prp_9",O="_dropdown_button_b3prp_57",j="_add_button_b3prp_57",F="_delete_button_b3prp_57",A="_year_options_group_b3prp_107",L="_placeholder_b3prp_149",M="_year_option_b3prp_107";const R=({activeYearIndex:e,yearIndexs:t,onEditYearIndex:n,onSelectYear:a,onDeleteYear:r,onAddYear:o})=>{const[l,s]=c.exports.useState(!1),[i,m]=c.exports.useState(!1),u=t.filter((t=>t!==e)),h=()=>{document.removeEventListener("click",h),m(!1)},_=()=>{document.removeEventListener("click",_),s(!1)},p=e=>()=>{a(e)};return console.log("[YearsEditor Render]"),d.createElement("div",{className:$},d.createElement("div",{className:A,"data-show":l?"true":"false"},0===u.length?d.createElement("div",{className:L},"空"):u.map((e=>d.createElement("div",{key:e,className:M,onClick:p(e)},e)))),d.createElement(w,{defaultText:`${e}`,className:P,disabled:!i,onDoubleClick:e=>{var t;!i&&e.ele&&e.evt&&(t=e.ele,e.evt.nativeEvent.stopPropagation(),document.addEventListener("click",h),m(!0),setTimeout((()=>{t.focus()})))},onClick:t=>{var n;i?null==(n=t.evt)||n.stopPropagation():a(e)},onDisabled:t=>{const a=parseInt(t.text);`${a}`!==t.text||isNaN(a)||u.includes(a)?t.ele&&(t.ele.textContent=`${e}`):n(e,a)}}),d.createElement("div",{className:O,onClick:e=>{!l&&(e=>{e.stopPropagation(),document.addEventListener("click",_),s(!0)})(e.nativeEvent),i&&h()}},d.createElement("div",null,"")),d.createElement("div",{className:F,onClick:()=>{r(e)}},""),d.createElement("div",{className:j,onClick:()=>{let e=(new Date).getFullYear();for(;t.includes(e);)e++;o(e)}},""))},J=({bookName:e,activeYearIndex:t,yearIndexs:n,onSelectYear:a,onEditYearIndex:r,onDeleteYear:o,onAddYear:l,onBookNameChange:s,onImportFile:i,onExportFile:c})=>(console.log("[Header Render]"),d.createElement("div",{className:T},d.createElement(R,{activeYearIndex:t,yearIndexs:n,onEditYearIndex:r,onAddYear:l,onDeleteYear:o,onSelectYear:a}),d.createElement(Y,{fileName:e,onFileNameChange:s,onImportFile:i,onExportFile:c})));var B="_month_list_item_5k1fa_1",H="_month_list_item_index_5k1fa_47",V="_month_list_item_title_5k1fa_63";const q=({monthIndex:e,monthTitle:t,selected:n,onSelectMonth:a})=>d.createElement("div",{className:`${B}`,onClick:a,"data-selected":n?"true":"false"},d.createElement("div",{className:H},e),d.createElement("div",{className:V},t));var U="_month_list_kdvn8_1";const W=({months:e,activeMonthIndex:t,onSelectMonth:n})=>(console.log("[MonthList Render]"),d.createElement("div",{className:U},e.map((e=>d.createElement(q,{monthIndex:e.index,monthTitle:e.title,selected:e.index===t,onSelectMonth:()=>n(e.index),key:e.index})))));var z="_diary_list_mf5ep_1";var G="_diary_list_item_7jkw0_1",K="_diary_list_item_index_7jkw0_47",Q="_diary_list_item_title_7jkw0_63";const X=({diaryIndex:e,diaryTitle:t,selected:n,onClick:a})=>d.createElement("div",{className:G,"data-selected":n?"true":"false",onClick:a},d.createElement("div",{className:K},e),d.createElement("div",{className:Q},t)),Z=({diarys:e,activeDiaryIndex:t,onSelectDiary:n})=>(console.log("[DiaryList Render]"),d.createElement("div",{className:z},e.map((e=>d.createElement(X,{diaryIndex:e.index,diaryTitle:e.title,selected:e.index===t,onClick:()=>n(e.index),key:e.index})))));var ee="_diary_page_1dkjo_1",te="_content_editor_1dkjo_27";var ne="_title_editor_1hgxa_1";const ae=({handle:e,title:t,onChange:n,placeholder:a})=>{const[r,o]=c.exports.useState(t);return c.exports.useEffect((()=>{o(t)}),[e]),console.log("[TitleEditor Render]"),d.createElement(w,{key:e,defaultText:r,placeholder:a||"",className:ne,onInput:e=>{n&&n(e.text)}})};var re="_rich_text_editor_13nt0_1";const oe=({handle:e,initialHtmlContent:t,className:n,onChange:a})=>d.createElement(m,{className:`${re} ${n}`,key:e,theme:"snow",defaultValue:t,onChange:e=>{a&&a(e)}});var le="_tag_gex5y_1",se="_text_gex5y_25",ie="_delete_button_gex5y_43";const ce=({target:e,text:t,onChange:n,onDelete:a})=>{const[r,o]=c.exports.useState(t);return c.exports.useEffect((()=>{o(t)}),[e]),d.createElement("div",{className:le},d.createElement(w,{key:e,defaultText:r,placeholder:"新标签",className:se,onInput:e=>{n(e.text)}}),d.createElement("div",{className:ie,onClick:a},""))};var de="_tags_bar_qrfca_1",me="_add_button_qrfca_25";const ue=({tags:e,onTagsChange:t})=>{const n=n=>()=>{const a=e.filter(((e,t)=>t!==n));t(a)};return d.createElement("div",{className:de},e.map(((a,r)=>{return d.createElement(ce,{key:r,target:`${e.length}/${r}`,text:a,onChange:(o=r,n=>{const a=[...e];a[o]=n,t(a)}),onDelete:n(r)});var o})),d.createElement("div",{className:me,onClick:()=>{const n=[...e,""];t(n)}},""))};var he="_current_path_z5u7r_1";const _e=({year:e,month:t,date:n})=>d.createElement("div",{className:he},d.createElement("div",null,e),0===t?void 0:d.createElement("div",null," / ",t),0===n?void 0:d.createElement("div",null," / ",n)),pe=({year:e,month:t,date:n,handle:a,title:r,tags:o,content:l,onTitleChange:s,onTagsChange:i,onContentChange:c,titleEditorPlaceholder:m})=>d.createElement("div",{className:ee},d.createElement(_e,{year:e,month:t,date:n}),d.createElement(ae,{handle:a,title:r,onChange:s,placeholder:m}),d.createElement(ue,{key:a,tags:o,onTagsChange:i}),d.createElement(oe,{className:te,onChange:c,handle:a,initialHtmlContent:l})),ye=e=>{const t=JSON.parse(JSON.stringify(e));return i(s({},t),{years:t.years.map((e=>{const t=new Ee(e.index,e.title,e.tags,e.summary);return e.months.map((e=>{const t=new ge(e.yearIndex,e.index,e.title,e.tags,e.summary);return e.diarys.forEach((e=>{t.diarys[e.index-1]=e})),t})).forEach((e=>{t.months[e.index-1]=e})),t}))})};class ve{constructor(e=""){this.data=e}}class xe{constructor(e,t="",n=[],a=new ve("")){this.index=e,this.title=t,this.tags=n,this.content=a}}class ge{constructor(e,t,n="",a=[],r=new ve(""),o=Array(((e,t)=>{const n=[void 0,31,28,31,30,31,30,31,30,30,31,30,31];return(e%4==0&&e%100!=0||e%400==0)&&(n[2]=29),n[t]})(e,t)).fill(0).map(((e,t)=>new xe(t+1)))){this.yearIndex=e,this.index=t,this.title=n,this.tags=a,this.summary=r,this.diarys=o}}class Ee{constructor(e,t="",n=[],a=new ve(""),r=Array(12).fill(0).map(((t,n)=>new ge(e,n+1)))){this.index=e,this.title=t,this.tags=n,this.summary=a,this.months=r}}class fe{constructor(e="新日记本",t=[new Ee((new Date).getFullYear())],n=""){this.bookName=e,this.years=t,this.password=n}}const Ne="V1_JSON",Ce="V2_JSON",we="V3_PASSWORD",ke=e=>{const t=(e=>{const t=JSON.parse(JSON.stringify(e));return i(s({},t),{years:t.years.map((e=>i(s({},e),{months:e.months.map((e=>i(s({},e),{diarys:e.diarys.filter((e=>!(""===e.content.data&&0===e.tags.length&&""===e.title)))}))).filter((e=>!(0===e.diarys.length&&""===e.summary.data&&0===e.tags.length&&""===e.title)))})))})})(e);return new Blob([we,";",JSON.stringify(t)])},be=e=>{switch((e=>{if("{"===e[0])return Ne;const t=[];let n=0;for(;";"!==e[n];)t.push(e[n]),n++;return t.join("")})(e)){case Ne:return t=e,i(s({},JSON.parse(t)),{password:""});case Ce:return(e=>{const t=JSON.parse(e);return i(s({},ye(t)),{password:""})})(e.slice(Ce.length+1));case we:return(e=>{const t=JSON.parse(e);return ye(t)})(e.slice(we.length+1));default:return new fe}var t},Ie=e=>{const t=ke(e);((e,t)=>{const n=document.createElement("a");n.download=e,n.href=window.URL.createObjectURL(t),n.style.display="none",document.body.appendChild(n),n.click()})(`${e.bookName}-${(()=>{const e=new Date;return`${e.getFullYear()}${`0${e.getMonth()+1}`.slice(-2)}${`0${e.getDate()}`.slice(-2)}-${`0${e.getHours()}`.slice(-2)}${`0${e.getMinutes()}`.slice(-2)}${`0${e.getSeconds()}`.slice(-2)}`})()}.ttd`,t)},Se={type:u.normal,title:"输入密码",closeButtonAriaLabel:"关闭"},De=({isShow:e,hide:t,verify:n})=>{const a=c.exports.createRef(),r=h("dialogLabel"),o=h("subTextLabel"),l=d.useMemo((()=>({titleAriaId:r,subtitleAriaId:o,isBlocking:!1,styles:{main:{maxWidth:450}}})),[r,o]),s=()=>{a.current&&(a.current.value=""),t()},i=s;return d.createElement("div",{style:{position:"fixed"}},d.createElement(_,{hidden:!e,onDismiss:i,dialogContentProps:Se,modalProps:l},d.createElement("input",{ref:a,type:"password"}),d.createElement(p,null,d.createElement(y,{onClick:()=>{a.current&&n(a.current.value)},text:"确定"}),d.createElement(v,{onClick:s,text:"取消"}))))},Ye=()=>{const{yearIndexs:e,months:t,diarys:n,activeYearIndex:a,activeDiaryIndex:r,activeMonthIndex:o,editTarget:l,editorHandle:m,bookName:u,passwordDialogShow:h,onSelectYear:_,onSelectMonth:p,onSelectDiary:y,onEditYearIndex:v,onDeleteYear:x,onAddYear:E,onBookNameChange:f,onImportFile:N,onExportFile:C,verifyPassword:w,hidePasswordDialog:k}=(()=>{const[e,t]=c.exports.useState(new fe),[n,a]=c.exports.useState(1/0),[r,o]=c.exports.useState(0),[l,d]=c.exports.useState(0),[m,u]=c.exports.useState(0),[h,_]=c.exports.useState(!1),[p,y]=c.exports.useState(new fe),v=e.years||[],x=v.filter((e=>e.index===n)).shift(),g=(null==x?void 0:x.months)||[],E=g[r-1],f=(null==E?void 0:E.diarys)||[],N=f[l-1],C=v.map((e=>e.index)),w=e.bookName;0===v.length||v.map((e=>e.index)).includes(n)||a(v.map((e=>e.index)).shift()||1/0);const k=0===n?"none":0===r?"year":0===l?"month":"diary",b={year:{title:n=>{x&&(x.title=n),t(s({},e))},tags:n=>{x&&(x.tags=n),t(s({},e))},summary:n=>{x&&(x.summary.data=n),t(s({},e))}},month:{title:n=>{E&&(E.title=n),t(s({},e))},tags:n=>{E&&(E.tags=n),t(s({},e))},summary:n=>{E&&(E.summary.data=n),t(s({},e))}},diary:{title:n=>{void 0!==N&&(N.title=n,t(s({},e)))},tags:n=>{void 0!==N&&(N.tags=n,t(s({},e)))},content:n=>{void 0!==N&&(N.content.data=n,t(s({},e)))}}},I={title:"year"===k?(null==x?void 0:x.title)||"":"month"===k?(null==E?void 0:E.title)||"":"diary"===k&&(null==N?void 0:N.title)||"",tags:"year"===k?(null==x?void 0:x.tags)||[]:"month"===k?(null==E?void 0:E.tags)||[]:"diary"===k&&(null==N?void 0:N.tags)||[],content:"year"===k?(null==x?void 0:x.summary.data)||"":"month"===k?(null==E?void 0:E.summary.data)||"":"diary"===k&&(null==N?void 0:N.content.data)||"",onTitleChange:"year"===k?b.year.title:"month"===k?b.month.title:"diary"===k?b.diary.title:()=>{},onTagsChange:"year"===k?b.year.tags:"month"===k?b.month.tags:"diary"===k?b.diary.tags:()=>{},onContentChange:"year"===k?b.year.summary:"month"===k?b.month.summary:"diary"===k?b.diary.content:()=>{},titleEditorPlaceholder:"year"===k?"年度总结标题":"month"===k?"月度总结标题":"diary"===k?"日记标题":""},S=()=>{_(!1)};return{yearIndexs:C,months:g,diarys:f,activeDiaryIndex:l,activeMonthIndex:r,activeYearIndex:n,editTarget:I,editorHandle:m,bookName:w,passwordDialogShow:h,onSelectYear:e=>{u((e=>e+1)),d(0),o(0),a(e)},onSelectMonth:e=>{u((e=>e+1)),d(0),o(e)},onSelectDiary:e=>{u((e=>e+1)),d(e)},onEditYearIndex:(n,r)=>{const l=v.filter((e=>e.index===n)).shift();null!=l&&(l.index=r,v.sort(((e,t)=>e.index-t.index)),t(s({},e)),d(0),o(0),a(r),u((e=>e+1)))},onDeleteYear:n=>{var r;const l=v.filter((e=>e.index!==n));t(i(s({},e),{years:l})),d(0),o(0),a((null==(r=v[0])?void 0:r.index)||1/0),u((e=>e+1))},onAddYear:n=>{const r=[...v];r.push(new Ee(n)),r.sort(((e,t)=>e.index-t.index)),t(i(s({},e),{years:r})),d(0),o(0),a(n),u((e=>e+1))},onBookNameChange:n=>{t(i(s({},e),{bookName:n}))},onImportFile:e=>{const t=be(e);y(t),_(!0),console.log(t.password)},onExportFile:()=>{Ie(e)},verifyPassword:e=>{p.password===e&&(t(s({},p)),u((e=>e+1)),y(new fe),console.log(p.password,e)),console.log(p.password,e),S()},hidePasswordDialog:S}})();return console.log("[App Render]"),d.createElement("div",{id:"app",className:g},d.createElement(J,{activeYearIndex:a,yearIndexs:e,bookName:u,onSelectYear:_,onEditYearIndex:v,onDeleteYear:x,onAddYear:E,onBookNameChange:f,onImportFile:N,onExportFile:C}),d.createElement(W,{months:t,activeMonthIndex:o,onSelectMonth:p}),0===o?void 0:d.createElement(Z,{diarys:n,activeDiaryIndex:r,onSelectDiary:y}),d.createElement(pe,{year:a,month:o,date:r,handle:m,title:l.title,tags:l.tags,content:l.content,titleEditorPlaceholder:l.titleEditorPlaceholder,onContentChange:l.onContentChange,onTagsChange:l.onTagsChange,onTitleChange:l.onTitleChange}),d.createElement(De,{isShow:h,hide:k,verify:w}))};x.render(d.createElement(d.StrictMode,null,d.createElement(Ye,null)),document.getElementById("root"));
